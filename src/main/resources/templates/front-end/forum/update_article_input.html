








<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>文章資料修改 - update_article_input.html</title>

<head th:insert="~{/front-end/forum/included-fragment}"></head>
<style type="text/css">
	
	button {
		padding: 5px;
	}
	form {
		display: table;
	}
	form div {
		display: table-row;
	}
	label, input, span, select {
		display: table-cell;
		margin: 5px;
		text-align: left;		
	}
	input[type=text], input[type=password], select, textarea {
		width: 200px;
		margin: 5px;
	}
	form div div {
		display: table-cell;
	}
	.center {
        margin-left: auto;
        margin-right: auto;
    }
</style>
</head>
<body>

<nav class="navbar navbar-expand-md navbar-dark bg-success fixed-top justify-content-center">
		 <div align="center"> <h2>文章資料修改 - update_article_input.html</h2>
		 <h3><a class="navbar-brand" th:href="@{/article/select_page}"><img th:src="@{/images/back1.gif}">回查詢頁</a></h3></div>
</nav>

		<!-- 記得加入登入驗證後才能修改文章的驗證機制 -->	

	<div align="center">
		<h3><b>所有欄位皆為必填欄位</b></h3>
		<form th:action="@{update}" method="post" th:object="${article}" enctype="multipart/form-data">
			<div>
			<label>文章編號:</label>
			<input type="text" th:field="*{articleID}" style="border:0px ; font-weight: bold;" readonly /><br/>
			</div>
			
			
			<div>
			<label>文章版塊:</label>
			<select th:field="*{board.boardID}">
				<option th:each="board : ${boardListData}" th:value="${board.boardID}" th:text="${board.boardName}" />
			</select>
			<span th:if="${#fields.hasErrors('board.boardID')}" th:errors="*{board.boardID}" class="error" id="board.boardID.errors"></span>
			</div>
			
			<div>
			<label>文章類型:</label>
			<select th:field="*{articleCategory}">
			    <option th:each="category : ${articleCategories}" th:value="${category}" th:text="${category}" />
			</select>
			<span th:if="${#fields.hasErrors('articleCategory')}" th:errors="*{articleCategory}" class="error" id="articleCategory.errors"></span>
			</div>
			
					<!-- 先用直接輸入會員去測試 -->	
			<div>
			<label>會員名稱:</label>
			<select th:field="*{generalMember.memberID}">
				<option th:each="generalMember : ${generalMemberListData}" th:value="${generalMember.memberID}" th:text="${generalMember.memberName}" />
			</select>
			<span th:if="${#fields.hasErrors('generalMember.memberID')}" th:errors="*{generalMember.memberID}" class="error" id="generalMember.memberID.errors"></span>
			</div>
			
			
			<div>
			<label>文章標題:</label>
			<input type="text" th:field="*{articleTitle}" onclick="hideContent('articleTitle.errors');" /><br/>
			<span  th:if="${#fields.hasErrors('articleTitle')}" th:errors="*{articleTitle}" class="error" id="articleTitle.errors"></span>
			</div>
			
			<div>
			<label>文章內容:</label>
			<input type="text" th:field="*{articleContent}" onclick="hideContent('articleContent.errors');" /><br/>
			<span  th:if="${#fields.hasErrors('articleContent')}" th:errors="*{articleContent}" class="error" id="articleContent.errors"></span>
			</div>

		
			
 			 <div>
			        <label>文章圖片:</label>
			        <input type="file" id="articlePic" name="articlePic" multiple="multiple" accept="image/*" onchange="previewImage(this)" />
			        <span class="error" th:text="${warningMessage}" id="articlePic.errors"></span>
			
			        <div id="blob_holder" th:if="${!#lists.isEmpty(articleImgs)}">
			            <div th:each="img : ${articleImgs}" class="image-container">
			                <img th:if="${img != null and img.articleImgID != null}"
			                     th:src="@{/article/ArticleDBGifReader(articleImgID=${img.articleImgID})}" 
			                     width="100px" />
			                

			            </div>
			        </div>
			    </div>
			
			
			
			<div>
				<div></div>
				<div><button type="submit" id="submit"> 送出修改 </button></div>
				<div></div>
			</div>		
		</form>
	
	</div>


<script th:inline="javascript">



// 清除提示信息
function hideContent(d) {
    document.getElementById(d).style.display = "none";
}

// 照片上傳-預覽用
var filereader_support = typeof FileReader != 'undefined';
if (!filereader_support) {
    alert("No FileReader support");
}
var acceptedTypes = {
    'image/png': true,
    'image/jpeg': true,
    'image/gif': true
};

// 清空預覽區域並設置新的預覽
function previewImage() {
    var upfile1 = document.getElementById("articlePic");
    upfile1.addEventListener("change", function(event) {
        var files = event.target.files || event.dataTransfer.files;
        
        // 清空預覽區域
        var blob_holder = document.getElementById("blob_holder");
        while (blob_holder.firstChild) {
            blob_holder.removeChild(blob_holder.firstChild);
        }
        
        for (var i = 0; i < files.length; i++) {
            previewfile(files[i])
        }
    }, false);
}

function previewfile(file) {
    var blob_holder = document.getElementById("blob_holder");
    if (filereader_support === true && acceptedTypes[file.type] === true) {
        var reader = new FileReader();
        reader.onload = function(event) {
            var image = new Image();
            image.src = event.target.result;
            image.width = 100;
            image.height = 75;
            image.border = 2;
            blob_holder.appendChild(image);
        };
        reader.readAsDataURL(file);
        document.getElementById('submit').disabled = false;
    } else {
        blob_holder.innerHTML = "<div style='text-align: left;'>" + "● filename: " + file.name
            + "<br>" + "● ContentTyp: " + file.type
            + "<br>" + "● size: " + file.size + "bytes"
            + "<br>" + "● 上傳ContentType限制: <b> <font color=red>image/png、image/jpeg、image/gif </font></b></div>";
        document.getElementById('submit').disabled = true;
    }
}

// 頁面加載完成後初始化預覽功能
window.addEventListener('DOMContentLoaded', function(event) {
    previewImage();
});
</script>

</body>
</html>